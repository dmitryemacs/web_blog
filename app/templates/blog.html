{% extends 'base.html' %}
{% block content %}
    <h1>{{ blog.title }}</h1>
    {% if current_user.is_authenticated %}
        {% if current_user == blog.owner %}
            <a href="{{ url_for('main.edit_blog', blog_id=blog.id) }}" class="btn btn-secondary btn-sm">Редактировать блог</a>
            <form action="{{ url_for('main.delete_blog', blog_id=blog.id) }}" method="POST" style="display: inline;">
                <button type="submit" class="btn btn-danger btn-sm">Удалить блог</button>
            </form>
            <a href="{{ url_for('main.new_post', blog_id=blog.id) }}" class="btn btn-primary btn-sm">Создать новый пост</a>
        {% else %}
            {# Кнопки подписки/отписки для других пользователей #}
            {% if is_subscribed %}
                <form action="{{ url_for('main.unsubscribe_blog', blog_id=blog.id) }}" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-warning btn-sm">Отписаться</button>
                </form>
            {% else %}
                <form action="{{ url_for('main.subscribe_blog', blog_id=blog.id) }}" method="POST" style="display: inline;">
                    <button type="submit" class="btn btn-success btn-sm">Подписаться</button>
                </form>
            {% endif %}
        {% endif %}
    {% endif %}

    <p>{{ blog.description }}</p>
    <p>Автор: {{ blog.owner.username }}</p>
    <p>Создан: {{ blog.created_at.strftime('%Y-%m-%d %H:%M') }}</p>

    <hr>
    <h3>Посты в этом блоге</h3>
    {% if posts %}
        {% for post in posts %}
            <div class="card mb-3">
                <div class="card-body">
                    <h5 class="card-title"><a href="{{ url_for('main.post', post_id=post.id) }}">{{ post.title }}</a></h5>
                    <h6 class="card-subtitle mb-2 text-muted">{{ post.created_at.strftime('%Y-%m-%d') }}</h6>
                    <p class="card-text">{{ post.content[:150] }}...</p> {# Показываем часть контента #}
                    <a href="{{ url_for('main.post', post_id=post.id) }}" class="card-link">Читать далее</a>
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>В этом блоге пока нет постов.</p>
        {% if current_user.is_authenticated and current_user == blog.owner %}
            <p><a href="{{ url_for('main.new_post', blog_id=blog.id) }}">Создайте первый!</a></p>
        {% endif %}
    {% endif %}
{% endblock %}