{% extends 'base.html' %}
{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>{{ post.title }}</h2>
        {% if current_user.is_authenticated and current_user == post.blog.owner %}
            <div>
                <a href="{{ url_for('main.edit_post', post_id=post.id) }}" class="btn btn-warning btn-sm me-2">Редактировать пост</a>
                <form action="{{ url_for('main.delete_post', post_id=post.id) }}" method="POST" style="display:inline;">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Вы уверены, что хотите удалить этот пост?');">Удалить пост</button>
                </form>
            </div>
        {% endif %}
    </div>
    <p class="text-muted">В блоге: <a href="{{ url_for('main.blog', blog_id=post.blog.id) }}">{{ post.blog.title }}</a></p>
    <p class="text-muted">Автор блога: {{ post.blog.owner.username }}</p>
    <p class="text-muted">Создан: {{ post.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
    {% if post.updated_at %}
        <p class="text-muted">Обновлен: {{ post.updated_at.strftime('%Y-%m-%d %H:%M') }}</p>
    {% endif %}
    <hr>
    <div class="post-content mb-4">
        {{ post.content | safe }} {# Использование | safe, если контент может содержать HTML #}
    </div>

    {# Секция для комментариев (если будет реализована) #}
    <hr>
    <h3>Комментарии</h3>
    {% if post.comments %}
        <ul class="list-group mb-3">
            {% for comment in post.comments %}
                <li class="list-group-item">
                    <small class="text-muted">{{ comment.author.username }} ({{ comment.created_at.strftime('%Y-%m-%d %H:%M') }}):</small><br>
                    {{ comment.content }}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Комментариев пока нет.</p>
    {% endif %}

    {# Здесь можно добавить форму для добавления нового комментария #}
    {% if current_user.is_authenticated %}
        {# <form method="POST" action="{{ url_for('main.add_comment', post_id=post.id) }}">
            {{ comment_form.hidden_tag() }}
            <div class="mb-3">
                {{ comment_form.content.label(class="form-label") }}
                {{ comment_form.content(class="form-control", rows="3") }}
            </div>
            {{ comment_form.submit(class="btn btn-primary") }}
        </form> #}
        <p class="text-muted">Для добавления комментариев требуется реализация формы и логики в `routes.py`.</p>
    {% else %}
        <p class="text-muted">Чтобы оставить комментарий, пожалуйста <a href="{{ url_for('main.login') }}">войдите</a>.</p>
    {% endif %}

{% endblock %}